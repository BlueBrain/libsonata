language: python
branches:
  only:
    - master

matrix:
  include:
    - os: linux
      dist: trusty
      sudo: required
      python: 3.6
    - os: linux
      dist: trusty
      sudo: required
      python: 2.7

    - os: osx
      osx_image: xcode10.3
      language: generic
      python: 3.6
    - os: osx
      osx_image: xcode10.3
      language: generic
      python: 2.7

addons:
  homebrew:
    packages:
    - hdf5
  apt:
    packages:
    - libhdf5-dev

cache:
  directories:
    - $HOME/.cache/pip

before_install:
  - rm -rf dist *.egg-info && python setup.py sdist

install: skip
script:
  - ci/cpp_test.sh
  - ci/python_test.sh

deploy:
  provider: script
  script: bash ci/python_sdist.sh
