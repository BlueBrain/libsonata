language: python

matrix:
  include:
    - os: linux
      dist: trusty
      sudo: required
      python: 3.6
    - os: linux
      dist: trusty
      sudo: required
      python: 2.7

    - os: osx
      osx_image: xcode10.1
      language: generic
      python: 3.6
    - os: osx
      osx_image: xcode10.1
      language: generic
      python: 2.7

cache:
  directories:
    - $HOME/.cache/pip
    - $HOME/Library/Caches/Homebrew

before_install:
  - rm -rf dist *.egg-info && python setup.py sdist
  - if [ $TRAVIS_OS_NAME = linux ]; then sudo apt-get install libhdf5-dev; else brew install hdf5; fi
  - pip install --upgrade pip
  - pip install virtualenv
  - virtualenv env && source env/bin/activate

install:
  - pip install nose dist/*.tar.gz

script:
  - nosetests python &&
    rm -rf build && mkdir build && cd build && cmake -DCMAKE_BUILD_TYPE=Release -DEXTLIB_FROM_SUBMODULES=ON .. && make && make test
